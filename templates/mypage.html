<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
  <title>{{ 'ë§ˆì´í˜ì´ì§€' if is_own_profile else (profile.get('nickname', '') or 'íšŒì›') + ' í”„ë¡œí•„' }} | Ntpercent</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/loading.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
  <style>
    @font-face {
      font-family: 'Pretendard Variable';
      src: url("{{ url_for('static', filename='font/PretendardVariable.ttf') }}") format('truetype');
      font-weight: 100 900;
      font-style: normal;
    }
    :root {
      --main-purple: #6d28d9;
      --main-purple-hover: #5b21b6;
      --soft-purple: #ede9fe;
      --text-dark: #212121;
      --gray-muted: #9ca3af;
      --bg-white: #ffffff;
      --border-gray: #e5e7eb;
      --radius: 8px;
      --radius-lg: 12px;
      --font: 'Pretendard Variable', 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font);
      background: #f9fafb;
      color: var(--text-dark);
      font-weight: 500;
      min-height: 100vh;
      line-height: 1.5;
    }
    .main-wrap { margin-left: 260px; }
    .container { max-width: 960px; margin: 0 auto; padding: 24px; }
    .page-header {
      margin-bottom: 32px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--border-gray);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }
    .page-header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-dark);
      margin: 0;
    }
    /* ëŒ€í‘œ ì‘í’ˆ (Pinned Portfolio) */
    .pinned-portfolio-section {
      margin-bottom: 24px;
    }
    .pinned-portfolio-section h3 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-gray);
    }
    .pinned-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    @media (max-width: 768px) {
      .pinned-cards { grid-template-columns: 1fr; }
    }
    .pinned-card {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      transition: transform 0.2s, box-shadow 0.2s;
      text-decoration: none;
      color: inherit;
      display: block;
    }
    .pinned-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }
    .pinned-card-thumb {
      aspect-ratio: 4/3;
      background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
      background-size: cover;
      background-position: center;
      position: relative;
    }
    .pinned-card-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 10px;
      font-size: 0.7rem;
      font-weight: 700;
      color: #b45309;
      background: linear-gradient(180deg, #fef3c7, #fde68a);
      border: 1px solid #e8b923;
      border-radius: 20px;
    }
    .pinned-card-title {
      padding: 14px;
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-dark);
    }
    /* ì¹´ë“œ ê³µí†µ */
    .card {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      overflow: hidden;
    }
    /* ê³„ì • ì •ë³´ ì¹´ë“œ */
    .account-card {
      padding: 0;
      margin-bottom: 24px;
    }
    .account-card .card-title {
      padding: 20px 24px;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-dark);
      border-bottom: 1px solid var(--border-gray);
    }
    .account-card .card-body {
      padding: 20px 24px;
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 16px 24px;
    }
    @media (max-width: 600px) {
      .account-card .card-body { grid-template-columns: 1fr; }
    }
    .account-card .row {
      display: contents;
    }
    .account-card .label {
      font-size: 0.9rem;
      color: var(--gray-muted);
    }
    .account-card .value {
      font-size: 0.9rem;
      color: var(--text-dark);
    }
    /* ìš”ì•½ ëŒ€ì‹œë³´ë“œ */
    .dashboard-summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    @media (max-width: 768px) {
      .dashboard-summary { grid-template-columns: 1fr; }
    }
    .summary-card {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .summary-card .summary-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    .summary-card .summary-icon.trophy { background: linear-gradient(135deg, #fef3c7, #fde68a); }
    .summary-card .summary-icon.money { background: linear-gradient(135deg, #d1fae5, #a7f3d0); }
    .summary-card .summary-icon.rocket { background: linear-gradient(135deg, #e0e7ff, #c7d2fe); }
    .summary-card .summary-value { font-size: 1.25rem; font-weight: 700; color: var(--text-dark); }
    .summary-card .summary-label { font-size: 0.85rem; color: var(--gray-muted); margin-top: 2px; }
    /* ì°¸ê°€/íŒ¨ìŠ¤ ê³µëª¨ì „ */
    .participation-section {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      margin-bottom: 24px;
    }
    .participation-section h3 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-gray);
    }
    .participation-list { display: flex; flex-direction: column; gap: 12px; }
    .participation-item-wrap {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: #faf9fc;
      border-radius: var(--radius);
      border: 1px solid var(--border-gray);
      transition: background 0.2s, border-color 0.2s;
    }
    .participation-item-wrap:hover { border-color: rgba(109,40,217,0.3); }
    .participation-item {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      min-width: 0;
      text-decoration: none;
      color: inherit;
    }
    .participation-item-wrap:hover .participation-item { background: transparent; }
    .participation-item-wrap:hover { background: var(--soft-purple); }
    .participation-delete-btn {
      flex-shrink: 0;
      padding: 4px 10px;
      border: 1px solid #dc2626;
      background: transparent;
      color: #dc2626;
      font-size: 0.75rem;
      font-weight: 500;
      border-radius: 4px;
      cursor: pointer;
    }
    .participation-delete-btn:hover { background: rgba(220, 38, 38, 0.1); }
    .participation-pagination {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-gray);
    }
    .participation-pagination button {
      padding: 6px 12px;
      border: 1px solid var(--border-gray);
      background: var(--bg-white);
      color: var(--text-dark);
      font-size: 0.85rem;
      border-radius: 4px;
      cursor: pointer;
    }
    .participation-pagination button:hover:not(:disabled) {
      border-color: var(--main-purple);
      color: var(--main-purple);
    }
    .participation-pagination button:disabled { opacity: 0.5; cursor: default; }
    .participation-pagination .participation-pages { display: flex; gap: 4px; }
    .participation-pagination .participation-page-btn {
      min-width: 32px;
      padding: 6px 10px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-dark);
      font-size: 0.85rem;
      border-radius: 4px;
      cursor: pointer;
    }
    .participation-pagination .participation-page-btn:hover { background: var(--soft-purple); }
    .participation-pagination .participation-page-btn.active {
      border-color: var(--main-purple);
      background: var(--soft-purple);
      color: var(--main-purple);
      font-weight: 600;
    }
    .participation-badge {
      flex-shrink: 0;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .participation-badge.participate { background: #d1fae5; color: #059669; }
    .participation-badge.pass { background: #e5e7eb; color: #6b7280; }
    .participation-info { flex: 1; min-width: 0; }
    .participation-title { font-size: 0.95rem; font-weight: 600; color: var(--text-dark); margin-bottom: 4px; }
    .participation-meta { font-size: 0.8rem; color: var(--gray-muted); }
    .actions-section {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      padding-top: 24px;
      border-top: 1px solid var(--border-gray);
    }
    .btn-outline {
      padding: 12px 24px;
      font-family: var(--font);
      font-size: 0.95rem;
      font-weight: 500;
      background: var(--bg-white);
      color: var(--main-purple);
      border: 2px solid var(--main-purple);
      border-radius: var(--radius);
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      transition: all 0.2s;
    }
    .btn-outline:hover {
      background: var(--soft-purple);
    }
    .btn-outline.danger {
      color: #dc2626;
      border-color: #dc2626;
    }
    .btn-outline.danger:hover {
      background: #fef2f2;
    }
    /* ì•ˆë‚´ ë²„íŠ¼ */
    .info-buttons {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-info {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--soft-purple);
      color: var(--main-purple);
      border: 1px solid rgba(109,40,217,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.2s;
    }
    .btn-info:hover {
      background: var(--main-purple);
      color: #fff;
      border-color: var(--main-purple);
    }
    .btn-info svg { width: 18px; height: 18px; }
    /* ëª¨ë‹¬ */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .modal-overlay.active { display: flex; }
    .modal-box {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      max-width: 480px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 24px 48px rgba(0,0,0,0.15);
    }
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-gray);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }
    .modal-header h4 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
      margin: 0;
    }
    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--gray-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: color 0.2s;
    }
    .modal-close:hover { color: var(--text-dark); }
    .modal-body {
      padding: 24px;
      font-size: 0.9rem;
      line-height: 1.7;
      color: var(--text-dark);
    }
    .modal-body table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      margin: 16px 0;
    }
    .modal-body th, .modal-body td {
      padding: 10px 12px;
      text-align: left;
      border: 1px solid var(--border-gray);
    }
    .modal-body th {
      background: var(--soft-purple);
      color: var(--main-purple);
      font-weight: 600;
    }
    .modal-body .info-item {
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-gray);
    }
    .modal-body .info-item:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
    .modal-body .info-item strong { color: var(--main-purple); }
    @media (max-width: 1200px) {
      .sidebar-team { display: none; }
      .main-wrap { margin-left: 0; }
    }
  </style>
</head>
<body>
  {% include 'partials/_navbar.html' %}
  {% include 'partials/_sidebar_team.html' %}

  <div class="main-wrap">
  <div class="container">
    <header class="page-header">
      <h1>{{ 'ë§ˆì´í˜ì´ì§€' if is_own_profile else 'í”„ë¡œí•„' }}</h1>
      <div class="info-buttons">
        {% if is_own_profile %}
        <button type="button" class="btn-profile-apply" onclick="openModal('modalProfileTheme')" title="í”„ë¡œí•„ í…Œë§ˆ ì„ íƒ">í”„ë¡œí•„ ì ìš©</button>
        <button type="button" class="btn-info" onclick="openModal('modalTier')" title="í‹°ì–´ ì‹œìŠ¤í…œ ì•ˆë‚´">ğŸ†</button>
        <button type="button" class="btn-info" onclick="openModal('modalTags')" title="ë¶„ì•¼ íƒœê·¸ ì•ˆë‚´">#</button>
        <button type="button" class="btn-info" onclick="openModal('modalHeadline')" title="í—¤ë“œë¼ì¸ ì•ˆë‚´">âœ¨</button>
        {% endif %}
        {% if not is_own_profile %}
        <a href="{{ url_for('home') }}" class="btn-outline">í™ˆìœ¼ë¡œ</a>
        {% endif %}
      </div>
    </header>

    {% if is_own_profile %}
    <!-- ê³„ì • ì •ë³´ ì¹´ë“œ -->
    <div class="card account-card">
      <div class="card-title">ê³„ì • ì •ë³´</div>
      <div class="card-body">
        <span class="label">ì´ë©”ì¼</span>
        <span class="value">{{ profile.get('email', '-') }}</span>
        <span class="label">ë‹‰ë„¤ì„</span>
        <span class="value">{{ profile.get('nickname', '-') }}</span>
      </div>
    </div>
    {% endif %}

    <!-- í”„ë¡œí•„ ì˜ì—­ (Tier tier-0~3, í…Œë§ˆ profile-theme-* ì ìš©) -->
    <section class="profile-section tier-{{ tier_level }}" id="profileSection" data-own-profile="{{ '1' if is_own_profile else '0' }}">
      {% if tier_level >= 2 %}
      <svg class="profile-border-svg" viewBox="0 0 500 300" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="goldSectionGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#e8b923" />
            <stop offset="50%" stop-color="#fcd34d" />
            <stop offset="100%" stop-color="#fde68a" />
          </linearGradient>
          <linearGradient id="rainbowSectionGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#f59e0b" />
            <stop offset="25%" stop-color="#ec4899" />
            <stop offset="50%" stop-color="#8b5cf6" />
            <stop offset="75%" stop-color="#06b6d4" />
            <stop offset="100%" stop-color="#f59e0b" />
          </linearGradient>
        </defs>
        <rect x="1.5" y="1.5" width="497" height="297" rx="12" ry="12" />
      </svg>
      {% endif %}
      {% if tier_level >= 3 %}
      <div class="tier-particles">
        <span class="tier-particle"></span><span class="tier-particle"></span><span class="tier-particle"></span>
        <span class="tier-particle"></span><span class="tier-particle"></span><span class="tier-particle"></span>
      </div>
      {% endif %}
      <div class="profile-top">
        <div class="avatar-wrap">
          <div class="avatar {% if tier_level >= 2 %}legend-border{% endif %}" id="profileAvatar" style="background-image: url('{{ profile.get('profile_url') or '' }}')">
            {% if not profile.get('profile_url') %}<span>{{ (profile.get('nickname') or '?')[:1] }}</span>{% endif %}
          </div>
          {% if tier_level >= 3 %}
          <span class="symbol-badge-medal" aria-hidden="true"></span>
          {% endif %}
          {% if is_own_profile %}
          <label class="btn-avatar-upload" title="í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½">
            <input type="file" id="avatarInput" accept="image/jpeg,image/png,image/gif,image/webp">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
          </label>
          {% endif %}
        </div>
        <div class="info">
          <h2>
            {{ profile.get('nickname', '') or 'íšŒì›' }}
            <span class="tier-name-badge tier-name-badge-{{ tier_name|lower }}">{{ tier_name }}</span>
            <span class="role-badge">{{ role_label }}</span>
          </h2>
          <p class="profile-tagline">
            {% if tier_level >= 3 %}AI ë””ìì¸ ë¶„ì•¼ ëˆ„ì  ìƒê¸ˆ 1ìœ„ Â· ë ˆì „ë“œ í¬ë¦¬ì—ì´í„°{% elif tier_level == 2 %}AI ë””ìì¸ ë¶„ì•¼ ìƒìœ„ 5% Â· GOLD í¬ë¦¬ì—ì´í„°{% elif tier_level == 1 %}ìˆ˜ìƒ í¬ë¦¬ì—ì´í„° Â· SILVER Tier{% else %}ìƒˆë¡œìš´ ë„ì „ì„ ì‹œì‘í•´ë³´ì„¸ìš”{% endif %}
          </p>
          <div class="expertise-tags">
            {% for tag in expertise_tags %}
            <span class="expertise-tag">#{{ tag }}</span>
            {% endfor %}
          </div>
          {% if is_own_profile %}
          <p style="font-size:0.85rem;color:var(--gray-muted);margin-top:8px;">{{ profile.get('email', '') }}</p>
          {% endif %}
        </div>
        {% if is_own_profile %}
        <a href="{{ url_for('mypage_password') }}" class="btn-outline profile-logout">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
        {% endif %}
      </div>
      <!-- ë ˆë²¨/EXP ë°”: ì¢Œì¸¡ ì— ë¸”ëŸ¼ + ìš°ì¸¡ ì„±ì¥ ì •ë³´ -->
      <div class="level-exp-block">
        <div class="level-exp-row">
          <div class="level-exp-emblem">
            <span class="tier-sprite tier-sprite-profile tier-sprite-{{ 5 if tier_level >= 3 else tier_level + 1 }}" aria-hidden="true"></span>
          </div>
          <div class="level-exp-info-col">
            <div class="level-tier-line">
              <span class="level-text">Lv.{{ level }}</span>
              <span class="tier-badge-pill tier-badge-pill-{{ tier_name|lower }}">{{ tier_name }}</span>
            </div>
            <div class="exp-bar-wrap">
              <div class="exp-bar-fill {% if tier_level >= 3 %}legend{% elif tier_level >= 2 %}gold{% endif %}" style="width: {{ exp_percent }}%"></div>
            </div>
            <p class="exp-next-hint">ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ {{ exp_next - exp_current }} EXP í•„ìš” ({{ exp_percent }}% ì™„ë£Œ)</p>
          </div>
        </div>
      </div>
      {% if is_own_profile %}
      <div class="profile-status-row">
        <div class="status-row-inner">
          <input type="text" class="status-input" id="statusInput" value="{{ profile.get('status_message') or '' }}" placeholder="ìƒíƒœ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì´ë²ˆ ì£¼ OO ê³µëª¨ì „ ë§ˆê°ì…ë‹ˆë‹¤!)" maxlength="80">
          <button type="button" class="btn-save-status" id="btnSaveStatus" title="ì €ì¥">ì €ì¥</button>
          <button type="button" class="btn-clear-status" id="btnClearStatus" title="ìƒíƒœ ë©”ì‹œì§€ ì‚­ì œ">ì‚­ì œ</button>
        </div>
      </div>
      {% endif %}
    </section>

    <!-- ëŒ€í‘œ ì‘í’ˆ (Pinned Portfolio) -->
    <section class="pinned-portfolio-section">
      <h3>ëŒ€í‘œ ì‘í’ˆ</h3>
      <div class="pinned-cards">
        {% for item in pinned_portfolio %}
        <a href="{{ item.url or '#' }}" class="pinned-card" target="_blank">
          <div class="pinned-card-thumb" style="{% if item.thumbnail %}background-image: url('{{ item.thumbnail }}');{% endif %}">
            <span class="pinned-card-badge">{{ item.award or 'ìˆ˜ìƒ' }}</span>
          </div>
          <div class="pinned-card-title">{{ item.title or 'ì‘í’ˆ ì œëª©' }}</div>
        </a>
        {% endfor %}
      </div>
    </section>

    <!-- ìš”ì•½ ëŒ€ì‹œë³´ë“œ -->
    <section class="dashboard-summary">
      <div class="summary-card">
        <div class="summary-icon trophy">ğŸ†</div>
        <div>
          <div class="summary-value">5ê±´</div>
          <div class="summary-label">ìˆ˜ìƒ</div>
        </div>
      </div>
      <div class="summary-card">
        <div class="summary-icon money">ğŸ’°</div>
        <div>
          <div class="summary-value">1,250ë§Œì›</div>
          <div class="summary-label">ìƒê¸ˆ</div>
        </div>
      </div>
      <div class="summary-card">
        <div class="summary-icon rocket">ğŸš€</div>
        <div>
          <div class="summary-value">20ê±´</div>
          <div class="summary-label">ë„ì „</div>
        </div>
      </div>
    </section>

    <!-- ì°¸ê°€/íŒ¨ìŠ¤ ê³µëª¨ì „ (ë³¸ì¸Â·íƒ€ì¸ í”„ë¡œí•„ ëª¨ë‘ í‘œì‹œ, 5ê°œì”© ìµœëŒ€ 10í˜ì´ì§€) -->
    <section class="participation-section" id="participationSection" data-user-id="{{ profile.get('id', '') }}" data-own-profile="{{ '1' if is_own_profile else '0' }}">
      <h3>ì°¸ê°€ / íŒ¨ìŠ¤ ê³µëª¨ì „</h3>
      <div class="participation-list" id="participationList">
        <div class="participation-loading" id="participationLoading" style="color:var(--gray-muted);padding:24px;text-align:center;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
      <div class="participation-pagination" id="participationPagination" style="display:none">
        <button type="button" class="participation-prev" id="participationPrev" title="ì´ì „">ì´ì „</button>
        <span class="participation-pages" id="participationPages"></span>
        <button type="button" class="participation-next" id="participationNext" title="ë‹¤ìŒ">ë‹¤ìŒ</button>
      </div>
    </section>
  </div>
  </div>

  <!-- ì•ˆë‚´ ëª¨ë‹¬: í‹°ì–´ ì‹œìŠ¤í…œ -->
  <div class="modal-overlay" id="modalTier">
    <div class="modal-box">
      <div class="modal-header">
        <h4>ğŸ† ìˆ˜ìƒ Tier ì‹œìŠ¤í…œ</h4>
        <button type="button" class="modal-close" onclick="closeModal('modalTier')" aria-label="ë‹«ê¸°">Ã—</button>
      </div>
      <div class="modal-body">
        <p>ìˆ˜ìƒ íšŸìˆ˜ì— ë”°ë¼ í”„ë¡œí•„ ì˜ì—­ì˜ ë¹„ì£¼ì–¼ì´ ì—…ê·¸ë ˆì´ë“œë©ë‹ˆë‹¤.</p>
        <table>
          <thead><tr><th>Tier</th><th>ì¡°ê±´</th><th>íš¨ê³¼</th></tr></thead>
          <tbody>
            <tr><td>Tier 0</td><td>ìˆ˜ìƒ 0íšŒ</td><td>ê¸°ë³¸ í° ë°°ê²½</td></tr>
            <tr><td>Tier 1</td><td>ìˆ˜ìƒ 1~2íšŒ</td><td>ì‹¤ë²„ í…Œë‘ë¦¬ + ì•„ë°”íƒ€ ì‹¤ë²„ ê¸€ë¡œìš°</td></tr>
            <tr><td>Tier 2</td><td>ìˆ˜ìƒ 3~4íšŒ</td><td>ê³¨ë“œ ë°°ê²½ + íšŒì „ ê³¨ë“œ ë³´ë” + shimmer íš¨ê³¼</td></tr>
            <tr><td>Tier 3</td><td>ìˆ˜ìƒ 5íšŒ ì´ìƒ</td><td>ë‹¤í¬ ë°°ê²½ + íŒŒí‹°í´ + ë¬´ì§€ê°œ ë³´ë” + LEGEND ë±ƒì§€</td></tr>
          </tbody>
        </table>
        <p style="font-size:0.85rem;color:var(--gray-muted);margin-top:12px;">ê³µëª¨ì „ ìˆ˜ìƒ ì‹¤ì ì´ ìŒ“ì¼ìˆ˜ë¡ ë” í™”ë ¤í•œ í”„ë¡œí•„ì„ ê°–ê²Œ ë©ë‹ˆë‹¤.</p>
      </div>
    </div>
  </div>

  <!-- ì•ˆë‚´ ëª¨ë‹¬: ë¶„ì•¼ íƒœê·¸ -->
  <div class="modal-overlay" id="modalTags">
    <div class="modal-box">
      <div class="modal-header">
        <h4># ë¶„ì•¼ ì „ë¬¸ì„± íƒœê·¸</h4>
        <button type="button" class="modal-close" onclick="closeModal('modalTags')" aria-label="ë‹«ê¸°">Ã—</button>
      </div>
      <div class="modal-body">
        <p>ì°¸ì—¬í•œ ê³µëª¨ì „Â·ìˆ˜ìƒ ë¶„ì•¼ ë°ì´í„°ê°€ ìŒ“ì´ë©´ ìë™ìœ¼ë¡œ í•´ë‹¹ íƒœê·¸ê°€ í”„ë¡œí•„ì— ì¶”ê°€ë©ë‹ˆë‹¤.</p>
        <table>
          <thead><tr><th>íƒœê·¸</th><th>ìë™ ì¶”ê°€ ì¡°ê±´</th></tr></thead>
          <tbody>
            <tr><td>#ë¹…ë°ì´í„°</td><td>ë¹…ë°ì´í„°/ë°ì´í„° ì‹œê°í™” ë¶„ì•¼ ê³µëª¨ì „ 1íšŒ ì´ìƒ ì°¸ì—¬ ë˜ëŠ” ìˆ˜ìƒ</td></tr>
            <tr><td>#AI ë””ìì¸</td><td>AIÂ·ìƒì„±í˜• ë””ìì¸ ë¶„ì•¼ ê³µëª¨ì „ 1íšŒ ì´ìƒ ì°¸ì—¬ ë˜ëŠ” ìˆ˜ìƒ</td></tr>
            <tr><td>#ë¡œê³  ë””ìì¸</td><td>ë¡œê³ Â·ë¸Œëœë”©Â·CI ë¶„ì•¼ ê³µëª¨ì „ 1íšŒ ì´ìƒ ì°¸ì—¬ ë˜ëŠ” ìˆ˜ìƒ</td></tr>
            <tr><td>#UX/UI</td><td>UXÂ·UIÂ·ì•± ë””ìì¸ ë¶„ì•¼ ê³µëª¨ì „ 1íšŒ ì´ìƒ ì°¸ì—¬ ë˜ëŠ” ìˆ˜ìƒ</td></tr>
            <tr><td>#í¬ìŠ¤í„°</td><td>í¬ìŠ¤í„°Â·ê·¸ë˜í”½ ë””ìì¸ ë¶„ì•¼ 1íšŒ ì´ìƒ ì°¸ì—¬ ë˜ëŠ” ìˆ˜ìƒ</td></tr>
            <tr><td>#ì˜ìƒ</td><td>ì˜ìƒÂ·UCCÂ·ê´‘ê³  ë¶„ì•¼ 1íšŒ ì´ìƒ ì°¸ì—¬ ë˜ëŠ” ìˆ˜ìƒ</td></tr>
            <tr><td>#ìºë¦­í„°</td><td>ìºë¦­í„°Â·ì¼ëŸ¬ìŠ¤íŠ¸ ë¶„ì•¼ 1íšŒ ì´ìƒ ì°¸ì—¬ ë˜ëŠ” ìˆ˜ìƒ</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ì•ˆë‚´ ëª¨ë‹¬: ìë™ í—¤ë“œë¼ì¸ -->
  <div class="modal-overlay" id="modalHeadline">
    <div class="modal-box">
      <div class="modal-header">
        <h4>âœ¨ ìë™ ìƒì„± í—¤ë“œë¼ì¸</h4>
        <button type="button" class="modal-close" onclick="closeModal('modalHeadline')" aria-label="ë‹«ê¸°">Ã—</button>
      </div>
      <div class="modal-body">
        <p>ì—­ëŸ‰ì´ ìŒ“ì´ë©´ í”„ë¡œí•„ì— ë…¸ì¶œë˜ëŠ” í•œ ì¤„ ìê¸°ì†Œê°œê°€ ìë™ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œë©ë‹ˆë‹¤. íƒ€ì¸ì´ í”„ë¡œí•„ ë°©ë¬¸ ì‹œ ì¦‰ì‹œ ì¸ìƒì ì…ë‹ˆë‹¤.</p>
        <div class="info-item">
          <strong>ìƒˆë¡œìš´ ë„ì „ì„ ì‹œì‘í•´ë³´ì„¸ìš”</strong><br>
          ì¡°ê±´: Tier 0 (ìˆ˜ìƒ ì—†ìŒ)
        </div>
        <div class="info-item">
          <strong>ìˆ˜ìƒ í¬ë¦¬ì—ì´í„° Â· SILVER Tier</strong><br>
          ì¡°ê±´: ìˆ˜ìƒ 1~2íšŒ (Tier 1 ë‹¬ì„±)
        </div>
        <div class="info-item">
          <strong>AI ë””ìì¸ ë¶„ì•¼ ìƒìœ„ 5% Â· GOLD í¬ë¦¬ì—ì´í„°</strong><br>
          ì¡°ê±´: ìˆ˜ìƒ 3~4íšŒ + í•´ë‹¹ ë¶„ì•¼ì—ì„œ ìƒìœ„ ìˆœìœ„ (Tier 2)
        </div>
        <div class="info-item">
          <strong>AI ë””ìì¸ ë¶„ì•¼ ëˆ„ì  ìƒê¸ˆ 1ìœ„ Â· ë ˆì „ë“œ í¬ë¦¬ì—ì´í„°</strong><br>
          ì¡°ê±´: ìˆ˜ìƒ 5íšŒ ì´ìƒ + ë¶„ì•¼ ë‚´ ìƒê¸ˆ 1ìœ„ (Tier 3)
        </div>
        <div class="info-item">
          <strong>[ì¶”ê°€ ì˜ˆì •] ë¶„ì•¼ë³„ ë¬¸ì¥</strong><br>
          ë¶„ì•¼ë³„ë¡œ "ë¡œê³  ë””ìì¸ ìˆ˜ìƒ 3íšŒ" ë“± ë°ì´í„°ì— ë§ëŠ” ë¬¸ì¥ì´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

  <!-- í”„ë¡œí•„ í…Œë§ˆ ìƒì  ëª¨ë‹¬ -->
  <div class="modal-overlay" id="modalProfileTheme">
    <div class="modal-box modal-profile-theme">
      <div class="modal-header">
        <h4>í”„ë¡œí•„ í…Œë§ˆ ìƒì </h4>
        <button type="button" class="modal-close" onclick="closeModal('modalProfileTheme')" aria-label="ë‹«ê¸°">Ã—</button>
      </div>
      <div class="modal-body">
        <p class="profile-theme-desc">ë³´ìœ í•œ ë ˆë²¨ì— ë”°ë¼ íŠ¹ë³„í•œ ì•„ìš°ë¼ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <div class="profile-theme-grid">
          <div class="profile-theme-card" data-theme="basic">
            <div class="theme-preview theme-basic">
              <div class="theme-preview-avatar"></div>
              <div class="theme-preview-bar"></div>
            </div>
            <div class="theme-info">
              <span class="theme-level">Lv.1 BASIC</span>
              <span class="theme-name">ìŠ¤íƒ€í„° íŒ©</span>
              <p class="theme-desc">ê¹”ë”í•˜ê³  êµ°ë”ë”ê¸° ì—†ëŠ” ê¸°ë³¸ í™”ì´íŠ¸ ìŠ¤íƒ€ì¼</p>
              <button type="button" class="theme-apply-btn">ì ìš©í•˜ê¸°</button>
            </div>
          </div>
          <div class="profile-theme-card" data-theme="rare">
            <div class="theme-preview theme-rare">
              <div class="theme-preview-avatar"></div>
              <div class="theme-preview-bar"></div>
            </div>
            <div class="theme-info">
              <span class="theme-level">Lv.5 RARE</span>
              <span class="theme-name">í¼í”Œ ë„¤ì˜¨</span>
              <p class="theme-desc">ì€ì€í•œ ë³´ëë¹› ê·¸ë¼ë°ì´ì…˜ê³¼ ë„¤ì˜¨ ë¼ì¸</p>
              <button type="button" class="theme-apply-btn">ì ìš©í•˜ê¸°</button>
            </div>
          </div>
          <div class="profile-theme-card" data-theme="epic">
            <div class="theme-preview theme-epic">
              <div class="theme-mini-particle"></div>
              <div class="theme-preview-avatar"></div>
              <div class="theme-preview-bar"></div>
            </div>
            <div class="theme-info">
              <span class="theme-level">Lv.10 EPIC</span>
              <span class="theme-name">ì¼ë£¨ì „ ë§ˆìŠ¤í„°</span>
              <p class="theme-desc">ì›€ì§ì´ëŠ” íŒŒí‹°í´ê³¼ íë¥´ëŠ” ì—ë„ˆì§€ ë°”</p>
              <button type="button" class="theme-apply-btn">ì ìš©í•˜ê¸°</button>
            </div>
          </div>
          <div class="profile-theme-card" data-theme="default">
            <div class="theme-preview theme-default-tier">
              <div class="tier-crown">ğŸ‘‘</div>
              <div class="theme-preview-avatar legendary"></div>
              <div class="theme-preview-bar legendary"></div>
            </div>
            <div class="theme-info">
              <span class="theme-level">SPECIAL</span>
              <span class="theme-name">í‹°ì–´ ë™ê¸°í™”</span>
              <p class="theme-desc">í˜„ì¬ ë‚˜ì˜ ì„±ì·¨ë„(Tier)ì— ë”°ë¼ ìë™ ë³€í™”</p>
              <button type="button" class="theme-apply-btn active">ì‚¬ìš© ì¤‘</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% include 'partials/_sidebar_users.html' %}
  {% include 'partials/_toast.html' %}

  <script>
    function openModal(id) {
      const el = document.getElementById(id);
      if (el) { el.classList.add('active'); document.body.style.overflow = 'hidden'; }
    }
    function closeModal(id) {
      const el = document.getElementById(id);
      if (el) { el.classList.remove('active'); document.body.style.overflow = ''; }
    }
    document.querySelectorAll('.modal-overlay').forEach(function(overlay) {
      overlay.addEventListener('click', function(e) {
        if (e.target === overlay) closeModal(overlay.id);
      });
    });
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') document.querySelectorAll('.modal-overlay.active').forEach(function(m) { closeModal(m.id); });
    });

    // í”„ë¡œí•„ í…Œë§ˆ ì ìš© (localStorage)
    const PROFILE_THEME_KEY = 'allyoung_profile_theme';
    const profileSection = document.getElementById('profileSection');
    function applyProfileTheme(theme) {
      if (!profileSection) return;
      profileSection.classList.remove('profile-theme-basic', 'profile-theme-rare', 'profile-theme-epic');
      if (theme && theme !== 'default') {
        profileSection.classList.add('profile-theme-' + theme);
      }
      try { localStorage.setItem(PROFILE_THEME_KEY, theme || 'default'); } catch (e) {}
      syncThemeButtons();
    }
    function syncThemeButtons() {
      try {
        const current = localStorage.getItem(PROFILE_THEME_KEY) || 'default';
        document.querySelectorAll('.profile-theme-card').forEach(function(card) {
          const btn = card.querySelector('.theme-apply-btn');
          if (!btn) return;
          const isActive = (card.dataset.theme || 'default') === current;
          btn.classList.toggle('active', isActive);
          btn.textContent = isActive ? 'ì‚¬ìš© ì¤‘' : 'ì ìš©í•˜ê¸°';
        });
      } catch (e) {}
    }
    (function initProfileTheme() {
      if (!profileSection || profileSection.dataset.ownProfile !== '1') return;
      try {
        const saved = localStorage.getItem(PROFILE_THEME_KEY) || 'default';
        if (saved && saved !== 'default') applyProfileTheme(saved);
        else syncThemeButtons();
      } catch (e) {}
    })();
    document.querySelectorAll('.profile-theme-card').forEach(function(card) {
      const btn = card.querySelector('.theme-apply-btn');
      const theme = card.dataset.theme;
      if (btn && theme) {
        btn.addEventListener('click', function() {
          if (btn.classList.contains('active')) return;
          applyProfileTheme(theme);
          closeModal('modalProfileTheme');
          var t = document.getElementById('toast'); if (t) { t.textContent = 'í”„ë¡œí•„ í…Œë§ˆê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.'; t.className = 'toast success'; t.style.display = 'block'; setTimeout(function() { t.style.display = 'none'; }, 2000); }
        });
      }
    });

    const avatarInput = document.getElementById('avatarInput');
    if (avatarInput) {
    avatarInput.addEventListener('change', async function(e) {
      const file = e.target.files?.[0];
      if (!file) return;
      const formData = new FormData();
      formData.append('file', file);
      try {
        const r = await fetch('/api/profile/update-image', { method: 'POST', body: formData });
        const j = await r.json();
        if (j.success && j.profile_url) {
          location.reload();
        } else {
          showToast(j.error || 'ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        }
      } catch (err) {
        showToast('ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
      }
      e.target.value = '';
    });
    }

    // ìƒíƒœ ë©”ì‹œì§€ ì €ì¥ (blur ì‹œ)
    const statusInput = document.getElementById('statusInput');
    if (statusInput) {
      let saveTimeout = null;
      function saveStatusMessage(isDelete) {
        const val = (statusInput.value || '').trim();
        fetch('/api/profile/status-message', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status_message: val })
        }).then(r => r.json()).then(j => {
          if (j.success) showToast(isDelete === true || !val ? 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          else showToast(j.error || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        });
      }
      statusInput.addEventListener('blur', saveStatusMessage);
      statusInput.addEventListener('input', function() {
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(saveStatusMessage, 800);
      });
      const btnSave = document.getElementById('btnSaveStatus');
      if (btnSave) btnSave.addEventListener('click', function() { saveStatusMessage(false); });
      const btnClear = document.getElementById('btnClearStatus');
      if (btnClear) {
        btnClear.addEventListener('click', function() {
          statusInput.value = '';
          saveStatusMessage(true);
        });
      }
    }

    // ì°¸ê°€/íŒ¨ìŠ¤ ê³µëª¨ì „ ëª©ë¡ ë¡œë“œ (5ê°œì”©, ìµœëŒ€ 10í˜ì´ì§€)
    const participationSection = document.getElementById('participationSection');
    const participationList = document.getElementById('participationList');
    const participationLoading = document.getElementById('participationLoading');
    const participationPagination = document.getElementById('participationPagination');
    const participationPrev = document.getElementById('participationPrev');
    const participationNext = document.getElementById('participationNext');
    const participationPages = document.getElementById('participationPages');
    const isOwnProfile = participationSection && participationSection.dataset.ownProfile === '1';
    const PARTICIPATION_PAGE_SIZE = 5;
    const PARTICIPATION_MAX_PAGES = 10;
    let participationAllData = [];
    let participationCurrentPage = 1;
    function renderParticipationList(data, page) {
      if (!participationList) return;
      participationAllData = data || [];
      participationCurrentPage = Math.max(1, Math.min(page || 1, PARTICIPATION_MAX_PAGES));
      const totalItems = Math.min(participationAllData.length, PARTICIPATION_PAGE_SIZE * PARTICIPATION_MAX_PAGES);
      const totalPages = Math.max(1, Math.ceil(totalItems / PARTICIPATION_PAGE_SIZE));
      const start = (participationCurrentPage - 1) * PARTICIPATION_PAGE_SIZE;
      const pageData = participationAllData.slice(start, start + PARTICIPATION_PAGE_SIZE);
      if (participationAllData.length === 0) {
        participationList.innerHTML = '<div style="color:var(--gray-muted);padding:24px;text-align:center;">ì°¸ê°€ ë˜ëŠ” íŒ¨ìŠ¤í•œ ê³µëª¨ì „ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        if (participationPagination) participationPagination.style.display = 'none';
        return;
      }
      participationList.innerHTML = pageData.map(function(item) {
        const badgeClass = item.status === 'participate' ? 'participate' : 'pass';
        const badgeText = item.status === 'participate' ? 'ì°¸ê°€' : 'íŒ¨ìŠ¤';
        const linkUrl = item.url || '#';
        const meta = [item.d_day && item.d_day !== '-' ? item.d_day : '', item.host && item.host !== '-' ? item.host : ''].filter(Boolean).join(' Â· ');
        const src = String(item.source || '').replace(/"/g, '&quot;');
        const cid = String(item.contest_id || '').replace(/"/g, '&quot;');
        const linkPart = '<a href="' + linkUrl + '" target="_blank" rel="noopener" class="participation-item">' +
          '<span class="participation-badge ' + badgeClass + '">' + badgeText + '</span>' +
          '<div class="participation-info">' +
          '<div class="participation-title">' + (item.title || '(ì œëª© ì—†ìŒ)').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div>' +
          (meta ? '<div class="participation-meta">' + meta.replace(/</g, '&lt;') + '</div>' : '') +
          '</div>' +
          '</a>';
        const delBtn = isOwnProfile ? '<button type="button" class="participation-delete-btn" data-source="' + src + '" data-contest-id="' + cid + '">ì‚­ì œ</button>' : '';
        return '<div class="participation-item-wrap">' + linkPart + delBtn + '</div>';
      }).join('');
      if (participationPagination) {
        participationPagination.style.display = totalPages > 1 ? 'flex' : 'none';
        if (participationPrev) {
          participationPrev.disabled = participationCurrentPage <= 1;
          participationPrev.onclick = function() { if (participationCurrentPage > 1) renderParticipationList(participationAllData, participationCurrentPage - 1); };
        }
        if (participationNext) {
          participationNext.disabled = participationCurrentPage >= totalPages;
          participationNext.onclick = function() { if (participationCurrentPage < totalPages) renderParticipationList(participationAllData, participationCurrentPage + 1); };
        }
        if (participationPages) {
          var maxShow = Math.min(totalPages, PARTICIPATION_MAX_PAGES);
          var html = [];
          for (var i = 1; i <= maxShow; i++) {
            var active = i === participationCurrentPage ? ' active' : '';
            html.push('<button type="button" class="participation-page-btn' + active + '" data-page="' + i + '">' + i + '</button>');
          }
          participationPages.innerHTML = html.join('');
          participationPages.querySelectorAll('.participation-page-btn').forEach(function(btn) {
            btn.addEventListener('click', function() { renderParticipationList(participationAllData, parseInt(btn.dataset.page, 10)); });
          });
        }
      }
      participationList.querySelectorAll('.participation-delete-btn').forEach(function(btn) {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          const src = btn.dataset.source || '';
          const cid = btn.dataset.contestId || '';
          if (!src || !cid) return;
          if (!confirm('ì´ ê³µëª¨ì „ì„ ì°¸ê°€/íŒ¨ìŠ¤ ëª©ë¡ì—ì„œ ì‚­ì œí• ê¹Œìš”?')) return;
          fetch('/api/contests/' + encodeURIComponent(src) + '/' + encodeURIComponent(cid) + '/participation', { method: 'DELETE' })
            .then(function(r) { return r.json(); })
            .then(function(j) {
              if (j.success) {
                const idx = participationAllData.findIndex(function(x) { return x.source === src && x.contest_id === cid; });
                if (idx >= 0) participationAllData.splice(idx, 1);
                renderParticipationList(participationAllData, participationCurrentPage);
                var t = document.getElementById('toast'); if (t) { t.textContent = 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'; t.className = 'toast success'; t.style.display = 'block'; setTimeout(function() { t.style.display = 'none'; }, 2000); }
              } else { alert(j.error || 'ì‚­ì œ ì‹¤íŒ¨'); }
            })
            .catch(function() { alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); });
        });
      });
    }
    if (participationList) {
      (async function() {
        try {
          const profileUserId = participationSection ? (participationSection.dataset.userId || '') : '';
          const url = profileUserId ? '/api/user/participation?user_id=' + encodeURIComponent(profileUserId) : '/api/user/participation';
          const r = await fetch(url);
          const j = await r.json();
          if (participationLoading) participationLoading.remove();
          renderParticipationList(j.data || [], 1);
        } catch (e) {
          if (participationLoading) participationLoading.remove();
          participationList.innerHTML = '<div style="color:#dc2626;padding:24px;text-align:center;">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
      })();
    }

    // ìµœê·¼ ë³¸ ê³µëª¨ì „ ë¡œë“œ (ë‚´ í”„ë¡œí•„ì¼ ë•Œë§Œ)
    (async function() {
      const ul = document.getElementById('recentContests');
      if (!ul) return;
      try {
        const raw = localStorage.getItem('allyoung_viewed');
        const ids = raw ? JSON.parse(raw) : [];
        if (ids.length === 0) return;
        const r = await fetch('/api/contests/by-ids?ids=' + ids.slice(-10).reverse().join(','));
        const j = await r.json();
        if (!j.success || !j.data || j.data.length === 0) return;
        ul.innerHTML = j.data.slice(0, 5).map(c =>
          '<li><a href="' + (c.url || '#') + '" target="_blank">' + (c.title || '-') + '</a></li>'
        ).join('');
      } catch (_) {}
    })();
  </script>
  {% include 'partials/_loading_overlay.html' %}
  <script src="{{ url_for('static', filename='js/loading.js') }}"></script>
</body>
</html>
