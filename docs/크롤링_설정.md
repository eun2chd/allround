# 크롤링 설정 (GitHub Actions + Supabase Edge Function)

30분마다 공모전 데이터를 크롤링해 Supabase `contests` 테이블에 저장합니다.

---

## 크롤링 전략

| 워크플로우 | 스케줄 | 페이지 | 설명 |
|------------|--------|--------|------|
| **Crawl Contests (30min)** | 30분마다 | 1~3페이지 | 신규 공고 + 최근 d-day 갱신 |
| **Crawl Contests (Full Daily)** | 매일 새벽 2시 | 1~10페이지 | 전체 d-day 갱신 (오래된 공고 포함) |

- 30분: 새 공고 빠르게 반영
- 일 1회 전체: 4~10페이지 공고 d-day 갱신
- Edge Function `?full=1` 또는 body `{"full": true}` 로 수동 전체 크롤링 가능

---

## 1. Edge Function 배포

```bash
# Supabase CLI 로그인 (최초 1회)
npx supabase login


올바른 project-ref 찾는 방법
방법 1 — 대시보드에서 복사 (가장 빠름)

Supabase 접속

프로젝트 선택

Settings → General

Reference ID 복사
# 프로젝트 연결
npx supabase link --project-ref mpebinshiekevzxbdaxb

# 함수 배포
npx supabase functions deploy crawl-contests
```

---

## 2. GitHub Secrets 설정

Repository → Settings → Secrets and variables → Actions 에서 추가:

| Secret 이름 | 설명 | 예시 |
|-------------|------|------|
| `SUPABASE_URL` | Supabase 프로젝트 URL | `https://xxxx.supabase.co` |
| `SUPABASE_SERVICE_ROLE_KEY` | 서비스 롤 키 (Settings → API) | `eyJhbGci...` |

> Service Role Key는 Dashboard → Project Settings → API 에서 확인

---

## 3. 동작

- **스케줄**: 매 30분 (`cron: '*/30 * * * *'`)
- **수동 실행**: Actions → Crawl Contests → Run workflow
- **흐름**: GitHub Actions → Edge Function 호출 → 크롤링 → Supabase upsert

---

## 4. 로컬 테스트

```bash
# Edge Function 로컬 실행
npx supabase functions serve crawl-contests --no-verify-jwt

# 호출 (다른 터미널)
curl -X POST http://localhost:54321/functions/v1/crawl-contests \
  -H "Authorization: Bearer <SUPABASE_SERVICE_ROLE_KEY>"
```
